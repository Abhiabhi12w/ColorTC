Sub FormatProperTables()
    Dim ws As Worksheet
    Set ws = ActiveSheet

    Dim lastRow As Long: lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    Dim i As Long: i = 1

    Do While i <= lastRow
        If LCase(Trim(ws.Cells(i, 1).Value)) = "docid" Then
            Dim docRow As Long: docRow = i
            Dim gmRow As Long: gmRow = i + 1
            Dim lineNoRow As Long: lineNoRow = i + 2
            
            Dim endRow As Long: endRow = FindNextEmptyRow(ws, docRow)
            Dim lastCol As Long: lastCol = GetLastUsedColumn(ws, docRow, endRow - 1)
            
            ' ðŸŸ§ docId row
            Call ColorRow(ws, docRow, lastCol, RGB(255, 235, 156))
            Call AddBorders(ws, docRow, lastCol)

            ' ðŸŸ§ GM* row
            If gmRow < endRow Then
                Call ColorRow(ws, gmRow, lastCol, RGB(255, 235, 156))
                Call AddBorders(ws, gmRow, lastCol)
            End If
            
            ' ðŸ”µ lineNo row
            If lineNoRow < endRow Then
                Call ColorRow(ws, lineNoRow, lastCol, RGB(221, 235, 247))
                Call AddBorders(ws, lineNoRow, lastCol)
            End If

            ' â¬œ Data rows (no color, just borders)
            Dim r As Long
            For r = lineNoRow + 1 To endRow - 1
                Call ClearFill(ws, r, lastCol)
                Call AddBorders(ws, r, lastCol)
            Next r

            i = endRow + 1 ' Jump to next table
        Else
            i = i + 1
        End If
    Loop
End Sub

Function FindNextEmptyRow(ws As Worksheet, startRow As Long) As Long
    Dim r As Long: r = startRow + 1
    Do While Application.WorksheetFunction.CountA(ws.Rows(r)) > 0
        r = r + 1
    Loop
    FindNextEmptyRow = r
End Function

Function GetLastUsedColumn(ws As Worksheet, startRow As Long, endRow As Long) As Long
    Dim maxCol As Long: maxCol = 0
    Dim r As Long
    For r = startRow To endRow
        Dim rowLastCol As Long
        rowLastCol = ws.Cells(r, ws.Columns.Count).End(xlToLeft).Column
        If rowLastCol > maxCol Then maxCol = rowLastCol
    Next r
    GetLastUsedColumn = maxCol
End Function

Sub ColorRow(ws As Worksheet, rowNum As Long, lastCol As Long, colorCode As Long)
    ws.Range(ws.Cells(rowNum, 1), ws.Cells(rowNum, lastCol)).Interior.Color = colorCode
End Sub

Sub ClearFill(ws As Worksheet, rowNum As Long, lastCol As Long)
    ws.Range(ws.Cells(rowNum, 1), ws.Cells(rowNum, lastCol)).Interior.ColorIndex = xlNone
End Sub

Sub AddBorders(ws As Worksheet, rowNum As Long, lastCol As Long)
    Dim rng As Range
    Set rng = ws.Range(ws.Cells(rowNum, 1), ws.Cells(rowNum, lastCol))
    
    With rng.Borders
        .LineStyle = xlContinuous
        .Color = vbBlack
        .Weight = xlThin
    End With
End Sub
